<!DOCTYPE html>
<html>

  <head>

    <meta charset="utf-8">
    <title>WebSockets - Simple chat</title>

    <!-- libraries -->
    <script src='ramda.js' type='text/javascript'></script>
    <script src='svg.js' type='text/javascript'></script>

    <!-- convert model to visualization -->
    <script src='realize.js' type='text/javascript'></script>
    <!-- prepare websocket connections behavior -->
    <script src="client.js" type='text/javascript'></script>

  </head>

  <body>
    <div id="content"></div>
    <div>
      <input type="text" id="input"/>
    </div>

    <script type='text/javascript'>

// html dom elements
var textContainer = document.getElementById('content');
var input = document.getElementById('input');


var initializeWebsocket = function (url) {
  window.WebSocket = window.WebSocket || window.MozWebSocket;
  if (!window.WebSocket) {
    content.innerHTML = '<p>Sorry, but your browser doesn\'t support WebSockets.';
    return undefined;
  }

  websocket = new WebSocket(url);
  return websocket;
}


var initializeUI = function (dom) {

  var svgns = 'http://www.w3.org/2000/svg';

  var container = document.createElementNS(svgns, 'svg');
  container.setAttribute('width', 1000);
  container.setAttribute('height', 800);

  dom.appendChild(container);
  return container;

};

var svg = SVG();
var svgContainer = initializeUI(textContainer);
var connection = initializeWebsocket('ws://127.0.0.1:1337');

var uiBuilder = modelBuilder(textContainer, svgContainer);

configureConnection(connection, uiBuilder.drawAgents, uiBuilder.onerror);


input.onkeypress = function(e) {
    console.log(e.keyCode);
    if (e.keyCode === 13) {

        var msg = input.value;
        if (!msg) { return; }

        connection.send(msg);
        input.value = '';
    }
};


    </script>
  </body>

</html>
